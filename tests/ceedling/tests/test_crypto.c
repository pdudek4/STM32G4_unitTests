/*
 * test_crypto.c
 *
 *  Created on: Oct 28, 2024
 *      Author: pdude
 */

//Test framework
#include "unity.h"

//Test framework local support
#include "testing_defines.h"

//Code Under Test
#include "crypto.h"

//Mocks

//CUT dependencies
#include "crypto.h"
#include "aes.h"


void setUp(void)
{
}

void tearDown(void)
{
}

//**********************************CRYPTO_decryptBlockWithSecretKey**************************
void test_CRYPTO_decryptBlockWithSecretKey_withoutInitSecretKey(void)
{
	int8_t retVal;
	uint8_t privateKey[16]    = { 0x9C, 0x8A, 0x50, 0xCD, 0xFC, 0xFD, 0x91, 0x60, 0xF5, 0xD4, 0x21, 0xBF, 0x8F, 0xD5, 0x72, 0x95};
	uint8_t privateKeyRef[16] = { 0x67, 0xC6, 0x69, 0x73, 0x51, 0xFF, 0x4A, 0xEC, 0x29, 0xCD, 0xBA, 0xAB, 0xF2, 0xFB, 0xE3, 0x46};

	CRYPTO_decryptBlockWithSecretKey(privateKey);
	retVal = memcmp(privateKey, privateKeyRef, 16);
	TEST_ASSERT_NOT_EQUAL_INT(0, retVal);
}

void test_CRYPTO_decryptBlockWithSecretKey(void)
{
	int8_t retVal;
	uint8_t privateKey[16]    = { 0x9C, 0x8A, 0x50, 0xCD, 0xFC, 0xFD, 0x91, 0x60, 0xF5, 0xD4, 0x21, 0xBF, 0x8F, 0xD5, 0x72, 0x95};
	uint8_t privateKeyRef[16] = { 0x67, 0xC6, 0x69, 0x73, 0x51, 0xFF, 0x4A, 0xEC, 0x29, 0xCD, 0xBA, 0xAB, 0xF2, 0xFB, 0xE3, 0x46};

	CRYPTO_initSecretKey();
	CRYPTO_decryptBlockWithSecretKey(privateKey);
	retVal = memcmp(privateKey, privateKeyRef, 16);
	TEST_ASSERT_EQUAL_INT(0, retVal);
}

//**********************************CRYPTO_decryptBlockWithPrivateKey**************************
void test_CRYPTO_decryptBlockWithPrivateKey_withoutInitPrivateKey(void)
{
	int8_t retVal;
	uint8_t bootPassword[16] = { 0xBE, 0x73, 0x23, 0xB8, 0xB1, 0x55, 0xA9, 0x99, 0x1E, 0x6F, 0x05, 0x2B, 0x79, 0xD0, 0xBF, 0x3D};

	uint8_t privateKeyRef[16] 	= { 0x67, 0xC6, 0x69, 0x73, 0x51, 0xFF, 0x4A, 0xEC, 0x29, 0xCD, 0xBA, 0xAB, 0xF2, 0xFB, 0xE3, 0x46};
	uint8_t bootPasswordRef[16] = { 0x6F, 0x46, 0x47, 0x57, 0x52, 0x79, 0x65, 0x73, 0x69, 0x4B, 0x75, 0x44, 0x78, 0x6A, 0x34, 0x42};

	CRYPTO_initSecretKey();

	CRYPTO_decryptBlockWithPrivateKey(bootPassword);
	retVal = memcmp(bootPassword, bootPasswordRef, 16);
	TEST_ASSERT_NOT_EQUAL_INT(0, retVal);
}

void test_CRYPTO_decryptBlockWithPrivateKey(void)
{
	int8_t retVal;
	uint8_t bootPassword[16] = { 0xBE, 0x73, 0x23, 0xB8, 0xB1, 0x55, 0xA9, 0x99, 0x1E, 0x6F, 0x05, 0x2B, 0x79, 0xD0, 0xBF, 0x3D};
	uint8_t infoBlock[16]    = { 0xB8, 0xFD, 0xF0, 0x9E, 0xCA, 0x15, 0xCC, 0x7E, 0x45, 0x5F, 0x27, 0xED, 0x1F, 0x56, 0xA5, 0x16};

	uint8_t privateKeyRef[16] 	= { 0x67, 0xC6, 0x69, 0x73, 0x51, 0xFF, 0x4A, 0xEC, 0x29, 0xCD, 0xBA, 0xAB, 0xF2, 0xFB, 0xE3, 0x46};
	uint8_t bootPasswordRef[16] = { 0x6F, 0x46, 0x47, 0x57, 0x52, 0x79, 0x65, 0x73, 0x69, 0x4B, 0x75, 0x44, 0x78, 0x6A, 0x34, 0x42};
	uint8_t infoBlockRef[16] 	= { 0x00, 0xE6, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x72, 0xEB, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

	CRYPTO_initSecretKey();

	CRYPTO_initPrivateKey(privateKeyRef);
	CRYPTO_decryptBlockWithPrivateKey(bootPassword);
	retVal = memcmp(bootPassword, bootPasswordRef, 16);
	TEST_ASSERT_UNLESS(retVal);

	CRYPTO_decryptBlockWithPrivateKey(infoBlock);
	retVal = memcmp(infoBlock, infoBlockRef, 16);
	TEST_ASSERT_UNLESS(retVal);

	CRYPTO_deInitPrivateKey();
}


